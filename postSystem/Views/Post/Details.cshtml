@model Post
@{
    ViewData["Title"] = Model.Title;
}
<h1>@Model.Title</h1>
<p class="text-muted">
    @Model.CreatedAt.ToString("dd MMM yyyy") |
    @Model.ViewsCount views
</p>
<style>
    /* Layout: image left (half screen), content right */
    .post-detail {
        display: flex;
        gap: 1.5rem;
        align-items: flex-start;
    }

    .post-detail .post-image {
        width: 50vw; /* half of viewport */
        max-width: 50%;
        max-height: 70vh;
        overflow: hidden;
        border-radius: 6px;
        background: #f8f9fa;
        flex-shrink: 0;
    }

    .post-detail .post-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .post-detail .post-content {
        width: calc(50vw - 1.5rem);
        max-width: 50%;
    }

    /* Responsive: stack on small screens */
    @@media (max-width: 768px) {
        .post-detail { flex-direction: column; }
        .post-detail .post-image, .post-detail .post-content { width: 100%; max-width: 100%; }
        .post-detail .post-image { max-height: 40vh; }
    }
</style>

<div class="post-detail mb-4">
    <div class="post-image">
        @if (!string.IsNullOrEmpty(Model.ImageUrl))
        {
            <img src="@Model.ImageUrl" alt="@Model.Title" />
        }
        else
        {
            <div class="w-100 d-flex align-items-center justify-content-center" style="height:300px;">
                <span class="text-muted">No Image</span>
            </div>
        }
    </div>

    <div class="post-content">
        <div class="mb-4">@Html.Raw(Model.Content)</div>

        <button class="btn btn-outline-danger mb-3" onclick="likePost('@Model.Id')">
            ❤️ Like (<span id="likeCount">@Model.LikesCount</span>)
        </button>
    </div>
</div>
<hr />
<h4>Comments</h4>
@foreach (var c in Model.Comments)
{
    <div class="border rounded p-3 mb-2">
        <strong>@c.UserName</strong>
        <p>@c.Content</p>
    </div>
}
<form asp-controller="Comment" asp-action="Add" method="post" class="mt-4">
    @Html.AntiForgeryToken()
    <input type="hidden" name="postId" value="@Model.Id" />
    <div class="mb-3">
        <label class="form-label">Name</label>
        <input name="userName" class="form-control" required />
    </div>
    <div class="mb-3">
        <label class="form-label">Comment</label>
        <textarea name="content" class="form-control" rows="3" required></textarea>
    </div>
    <button class="btn btn-success">Submit Comment</button>
</form>
@section Scripts {
    <script>
        if (!localStorage.getItem('fingerprint')) {
            localStorage.setItem('fingerprint', crypto.randomUUID());
        }
        function likePost(postId) {
                    fetch('/post/like', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                postId: postId,
                fingerprint: localStorage.getItem('fingerprint')
            })
        })
        .then(r => r.json())
        .then(d => {
            document.getElementById('likeCount').innerText = d.likes;
        });

        }
    </script>
}